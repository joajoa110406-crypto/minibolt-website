<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ì£¼ë¬¸ ë‚´ì—­ - MiniBolt</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Noto Sans KR',sans-serif;color:#333;background:#f5f5f5}
nav{background:#1a1a1a;color:#fff;padding:1rem 0;position:fixed;width:100%;top:0;z-index:999}
nav .container{max-width:1200px;margin:0 auto;display:flex;justify-content:space-between;align-items:center;padding:0 20px}
nav .logo{font-size:1.8rem;font-weight:700;color:#ff6b35}
nav ul{display:flex;list-style:none;gap:2rem}
nav a{color:#fff;text-decoration:none}
.header{background:linear-gradient(135deg,#2c3e50,#34495e);color:#fff;padding:120px 20px 60px;text-align:center;margin-top:70px}
.header h1{font-size:2.5rem}
.main{max-width:1200px;margin:0 auto;padding:60px 20px}
.order-card{background:#fff;border-radius:15px;padding:2rem;margin-bottom:2rem;box-shadow:0 2px 10px rgba(0,0,0,0.05)}
.order-header{display:flex;justify-content:space-between;align-items:center;padding-bottom:1rem;border-bottom:2px solid #f8f9fa;margin-bottom:1.5rem}
.order-date{color:#666;font-size:0.9rem}
.order-id{font-weight:600;color:#2c3e50;font-size:1.1rem}
.order-status{padding:0.4rem 1rem;border-radius:20px;font-size:0.85rem;font-weight:600}
.status-completed{background:#d4edda;color:#155724}
.status-shipping{background:#cce5ff;color:#004085}
.status-cancelled{background:#f8d7da;color:#721c24}
.order-items{margin-bottom:1.5rem}
.item-row{display:grid;grid-template-columns:2fr 1fr 1fr;gap:1rem;padding:1rem 0;border-bottom:1px solid #e9ecef;align-items:center}
.item-row:last-child{border-bottom:none}
.item-info h4{font-size:1rem;margin-bottom:0.3rem}
.item-info .specs{font-size:0.85rem;color:#666}
.item-qty{text-align:center;color:#666}
.item-price{text-align:right;font-weight:600;color:#ff6b35}
.order-summary{background:#f8f9fa;border-radius:10px;padding:1.5rem;margin-bottom:1rem}
.summary-row{display:flex;justify-content:space-between;margin-bottom:0.8rem}
.summary-row.total{font-size:1.3rem;font-weight:700;color:#ff6b35;border-top:2px solid #dee2e6;padding-top:1rem;margin-top:1rem}
.order-details{display:grid;grid-template-columns:1fr 1fr;gap:2rem;margin-top:1rem}
.detail-section h4{font-size:1rem;color:#2c3e50;margin-bottom:0.5rem;font-weight:600}
.detail-section p{font-size:0.9rem;color:#666;line-height:1.6}
.btn-detail{background:#ff6b35;color:#fff;border:none;padding:0.8rem 1.5rem;border-radius:8px;cursor:pointer;font-weight:600;transition:all .3s}
.btn-detail:hover{background:#e55a28;transform:translateY(-2px)}
.empty{text-align:center;padding:4rem;color:#666;background:#fff;border-radius:15px}
.empty i{font-size:4rem;margin-bottom:1rem;color:#ddd}
.filter-tabs{display:flex;gap:1rem;margin-bottom:2rem;flex-wrap:wrap}
.filter-tab{padding:0.8rem 1.5rem;background:#fff;border:2px solid #e0e0e0;border-radius:8px;cursor:pointer;font-weight:600;transition:all .3s}
.filter-tab.active{background:#ff6b35;color:#fff;border-color:#ff6b35}
.detail-modal{display:none;position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.7);z-index:9999;align-items:center;justify-content:center;padding:20px}
.modal-content{background:#fff;border-radius:15px;padding:2rem;max-width:800px;width:100%;max-height:90vh;overflow-y:auto}
.modal-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:2rem;border-bottom:2px solid #f8f9fa;padding-bottom:1rem}
.btn-close{background:#6c757d;color:#fff;border:none;padding:0.5rem 1rem;border-radius:6px;cursor:pointer;font-weight:600}
@media(max-width:768px){
.order-header{flex-direction:column;align-items:flex-start;gap:1rem}
.item-row{grid-template-columns:1fr}
.order-details{grid-template-columns:1fr}
}
</style>
</head>
<body>
<nav>
<div class="container">
<div class="logo"><i class="fa-solid fa-screwdriver-wrench"></i> MINI BOLT</div>
<ul>
<li><a href="index.html"><i class="fa-solid fa-house"></i> í™ˆ</a></li>
<li><a href="products.html"><i class="fa-solid fa-box"></i> ì œí’ˆ</a></li>
<li><a href="cart.html"><i class="fa-solid fa-shopping-cart"></i> ì¥ë°”êµ¬ë‹ˆ <span id="cart-count" style="background:#ff6b35;border-radius:50%;padding:2px 6px;font-size:0.8rem;margin-left:5px">0</span></a></li>
<li><a href="orders.html"><i class="fa-solid fa-receipt"></i> ì£¼ë¬¸ë‚´ì—­</a></li>
<li id="user-menu"></li>
</ul>
</div>
</nav>
<div class="header"><h1><i class="fa-solid fa-receipt"></i> ì£¼ë¬¸ ë‚´ì—­</h1></div>
<div class="main">
<div class="filter-tabs">
<button class="filter-tab active" onclick="filterOrders('all')">ì „ì²´</button>
<button class="filter-tab" onclick="filterOrders('COMPLETED')">ì™„ë£Œ</button>
<button class="filter-tab" onclick="filterOrders('SHIPPING')">ë°°ì†¡ì¤‘</button>
<button class="filter-tab" onclick="filterOrders('CANCELLED')">ì·¨ì†Œ</button>
</div>
<div id="orders-list"></div>
</div>

<!-- ì£¼ë¬¸ ìƒì„¸ ëª¨ë‹¬ -->
<div class="detail-modal" id="detail-modal">
<div class="modal-content">
<div class="modal-header">
<h2><i class="fa-solid fa-file-invoice"></i> ì£¼ë¬¸ ìƒì„¸</h2>
<button class="btn-close" onclick="closeModal()">ë‹«ê¸°</button>
</div>
<div id="modal-body"></div>
</div>
</div>

<script>
let allOrders = [];
let currentFilter = 'all';

function init() {
    allOrders = JSON.parse(localStorage.getItem('orders') || '[]');

    // ìµœì‹  ì£¼ë¬¸ì´ ìœ„ë¡œ ì˜¤ë„ë¡ ì •ë ¬
    allOrders.sort((a, b) => new Date(b.completedAt || b.createdAt) - new Date(a.completedAt || a.createdAt));

    displayOrders();
    updateCartCount();
    updateUserMenu();
}

function displayOrders() {
    const container = document.getElementById('orders-list');

    if (allOrders.length === 0) {
        container.innerHTML = `
            <div class="empty">
                <i class="fa-solid fa-receipt"></i>
                <h2>ì£¼ë¬¸ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤</h2>
                <p style="margin:1rem 0">ì²« ì£¼ë¬¸ì„ ì‹œì‘í•´ë³´ì„¸ìš”</p>
                <a href="products.html" class="btn-detail" style="display:inline-block;text-decoration:none;margin-top:1rem">ì œí’ˆ ë³´ëŸ¬ê°€ê¸°</a>
            </div>
        `;
        return;
    }

    const filteredOrders = currentFilter === 'all'
        ? allOrders
        : allOrders.filter(order => order.status === currentFilter);

    if (filteredOrders.length === 0) {
        container.innerHTML = `
            <div class="empty">
                <i class="fa-solid fa-search"></i>
                <h2>í•´ë‹¹í•˜ëŠ” ì£¼ë¬¸ì´ ì—†ìŠµë‹ˆë‹¤</h2>
            </div>
        `;
        return;
    }

    let html = '';
    filteredOrders.forEach((order, index) => {
        const statusText = getStatusText(order.status);
        const statusClass = getStatusClass(order.status);
        const orderDate = new Date(order.completedAt || order.createdAt);

        html += `
            <div class="order-card">
                <div class="order-header">
                    <div>
                        <div class="order-date">${formatDate(orderDate)}</div>
                        <div class="order-id">ì£¼ë¬¸ë²ˆí˜¸: ${order.orderId}</div>
                    </div>
                    <span class="order-status ${statusClass}">${statusText}</span>
                </div>

                <div class="order-items">
                    ${order.items.slice(0, 2).map(item => `
                        <div class="item-row">
                            <div class="item-info">
                                <h4>${item.name}</h4>
                                <div class="specs">M${item.diameter} Ã— ${item.length}mm | ${item.color}</div>
                            </div>
                            <div class="item-qty">${item.qty.toLocaleString()}ê°œ</div>
                            <div class="item-price">â‚©${calculateItemPrice(item).toLocaleString()}</div>
                        </div>
                    `).join('')}
                    ${order.items.length > 2 ? `<p style="text-align:center;color:#666;margin-top:1rem">ì™¸ ${order.items.length - 2}ê°œ ìƒí’ˆ</p>` : ''}
                </div>

                <div class="order-summary">
                    <div class="summary-row total">
                        <span>ì´ ê²°ì œê¸ˆì•¡:</span>
                        <span>â‚©${order.amount.toLocaleString()}</span>
                    </div>
                </div>

                <div style="text-align:right">
                    <button class="btn-detail" onclick="showDetail(${index})">
                        <i class="fa-solid fa-search"></i> ìƒì„¸ë³´ê¸°
                    </button>
                </div>
            </div>
        `;
    });

    container.innerHTML = html;
}

function showDetail(index) {
    const order = currentFilter === 'all'
        ? allOrders[index]
        : allOrders.filter(o => o.status === currentFilter)[index];

    const statusText = getStatusText(order.status);
    const statusClass = getStatusClass(order.status);
    const orderDate = new Date(order.completedAt || order.createdAt);

    const html = `
        <div class="order-header">
            <div>
                <div class="order-date">${formatDate(orderDate)}</div>
                <div class="order-id">ì£¼ë¬¸ë²ˆí˜¸: ${order.orderId}</div>
            </div>
            <span class="order-status ${statusClass}">${statusText}</span>
        </div>

        <h3 style="margin:2rem 0 1rem;color:#2c3e50">ì£¼ë¬¸ ìƒí’ˆ</h3>
        <div class="order-items">
            ${order.items.map(item => `
                <div class="item-row">
                    <div class="item-info">
                        <h4>${item.name}</h4>
                        <div class="specs">ID: ${item.id} | M${item.diameter} Ã— ${item.length}mm | ${item.color}</div>
                    </div>
                    <div class="item-qty">${item.qty.toLocaleString()}ê°œ</div>
                    <div class="item-price">â‚©${calculateItemPrice(item).toLocaleString()}</div>
                </div>
            `).join('')}
        </div>

        <div class="order-summary">
            <div class="summary-row">
                <span>ìƒí’ˆ ê¸ˆì•¡:</span>
                <span>â‚©${(order.productAmount || 0).toLocaleString()}</span>
            </div>
            <div class="summary-row">
                <span>ë°°ì†¡ë¹„:</span>
                <span>${(order.deliveryFee || 0) === 0 ? 'ë¬´ë£Œ' : 'â‚©' + (order.deliveryFee || 3000).toLocaleString()}</span>
            </div>
            <div class="summary-row">
                <span>ë¶€ê°€ì„¸ (10%):</span>
                <span>â‚©${(order.vat || Math.round(order.amount * 0.1 / 1.1)).toLocaleString()}</span>
            </div>
            <div class="summary-row total">
                <span>ì´ ê²°ì œê¸ˆì•¡:</span>
                <span>â‚©${order.amount.toLocaleString()}</span>
            </div>
        </div>

        <h3 style="margin:2rem 0 1rem;color:#2c3e50">ë°°ì†¡ ì •ë³´</h3>
        <div class="order-details">
            <div class="detail-section">
                <h4><i class="fa-solid fa-user"></i> ì£¼ë¬¸ì ì •ë³´</h4>
                <p>
                    <strong>ì´ë¦„:</strong> ${order.buyerName}<br>
                    <strong>ì´ë©”ì¼:</strong> ${order.buyerEmail}<br>
                    <strong>ì—°ë½ì²˜:</strong> ${order.buyerPhone}
                </p>
            </div>
            <div class="detail-section">
                <h4><i class="fa-solid fa-truck"></i> ë°›ëŠ” ë¶„ ì •ë³´</h4>
                <p>
                    <strong>ì´ë¦„:</strong> ${order.receiverName}<br>
                    <strong>ì—°ë½ì²˜:</strong> ${order.receiverPhone}<br>
                    <strong>ì£¼ì†Œ:</strong> ${order.address}
                    ${order.deliveryMessage ? `<br><strong>ìš”ì²­ì‚¬í•­:</strong> ${order.deliveryMessage}` : ''}
                </p>
            </div>
        </div>

        ${order.paymentMethod ? `
            <h3 style="margin:2rem 0 1rem;color:#2c3e50">ê²°ì œ ì •ë³´</h3>
            <div class="detail-section">
                <p>
                    <strong>ê²°ì œë°©ë²•:</strong> ${order.paymentMethod === 'CARD' ? 'ì‹ ìš©ì¹´ë“œ' : order.paymentMethod}<br>
                    ${order.paymentKey ? `<strong>ê²°ì œ ê³ ìœ ë²ˆí˜¸:</strong> ${order.paymentKey}` : ''}
                </p>
            </div>
        ` : ''}
    `;

    document.getElementById('modal-body').innerHTML = html;
    document.getElementById('detail-modal').style.display = 'flex';
}

function closeModal() {
    document.getElementById('detail-modal').style.display = 'none';
}

function filterOrders(status) {
    currentFilter = status;
    document.querySelectorAll('.filter-tab').forEach(tab => {
        tab.classList.remove('active');
    });
    event.target.classList.add('active');
    displayOrders();
}

function calculateItemPrice(item) {
    const unitPrice = item.qty >= 1000 ? item.price_1000 / 1000 : item.price_100 / 100;
    return Math.round(unitPrice * item.qty);
}

function getStatusText(status) {
    const statusMap = {
        'COMPLETED': 'ì£¼ë¬¸ì™„ë£Œ',
        'SHIPPING': 'ë°°ì†¡ì¤‘',
        'DELIVERED': 'ë°°ì†¡ì™„ë£Œ',
        'CANCELLED': 'ì£¼ë¬¸ì·¨ì†Œ'
    };
    return statusMap[status] || 'ì£¼ë¬¸ì™„ë£Œ';
}

function getStatusClass(status) {
    if (status === 'CANCELLED') return 'status-cancelled';
    if (status === 'SHIPPING' || status === 'DELIVERED') return 'status-shipping';
    return 'status-completed';
}

function formatDate(date) {
    const year = date.getFullYear();
    const month = String(date.getMonth() + 1).padStart(2, '0');
    const day = String(date.getDate()).padStart(2, '0');
    const hours = String(date.getHours()).padStart(2, '0');
    const minutes = String(date.getMinutes()).padStart(2, '0');
    return `${year}.${month}.${day} ${hours}:${minutes}`;
}

function updateCartCount(){
const cart=JSON.parse(localStorage.getItem('cart')||'[]');
const count=cart.reduce((sum,item)=>sum+item.qty,0);
const el=document.getElementById('cart-count');
if(el)el.textContent=count;
}

function updateUserMenu(){
const user=JSON.parse(localStorage.getItem('user')||'null');
const userMenu=document.getElementById('user-menu');
if(!userMenu)return;
if(user){
userMenu.innerHTML=`<a href="#" style="display:flex;align-items:center;gap:0.5rem">${user.profile_image?`<img src="${user.profile_image}" style="width:30px;height:30px;border-radius:50%">`:'ğŸ‘¤'}${user.name}</a><a href="#" onclick="logout();return false" style="color:#ff6b35">ë¡œê·¸ì•„ì›ƒ</a>`;
userMenu.style.display='flex';
userMenu.style.gap='1rem';
}else{
userMenu.innerHTML='<a href="login.html">ë¡œê·¸ì¸</a>';
}
}

function logout(){
if(confirm('ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')){
localStorage.removeItem('user');
alert('ë¡œê·¸ì•„ì›ƒë˜ì—ˆìŠµë‹ˆë‹¤.');
updateUserMenu();
}
}

// ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
window.onclick = function(event) {
    const modal = document.getElementById('detail-modal');
    if (event.target === modal) {
        closeModal();
    }
}

document.addEventListener('DOMContentLoaded', init);
</script>
</body>
</html>
